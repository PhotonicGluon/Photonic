---
import path from "path";

import { Image } from "astro:assets";
import type { CollectionEntry } from "astro:content";

import { toProject } from "@lib/projects/project";
import { toDateString } from "@lib/misc/dates";

import ProjectTags from "@components/projects/ProjectTags";

import MainLayout from "@layouts/MainLayout.astro";

type Props = CollectionEntry<"projects">["data"];
const project = toProject(Astro.props);

// Check if we can eagerly load the image
let bannerImage = null;
if (project.banner && !project.banner.startsWith("http")) {
    // Form correct absolute path to the banner
    const bannerPath = path.join(path.relative(import.meta.dirname, process.cwd()), "public", project.banner);

    // Import local image
    bannerImage = (await import(/* @vite-ignore */ bannerPath)).default;
}
---

{/* TODO: Update */}
<MainLayout
    title={project.name}
    subtitle=`${toDateString(project.dates.start)} â€” ${project.dates.end ? toDateString(project.dates.end) : "Present"}`
>
    <slot name="head-fonts" slot="head-fonts" />
    <slot name="head-scripts" slot="head-scripts" />

    {/* Handle banner image */}
    <div class="w-full">
        {bannerImage && <Image src={bannerImage} alt={`${project.name} Banner`} class="banner-image" />}
        {/* TODO: Can we use <Image> for remote images? */}
        {
            !bannerImage && project.banner && (
                <img src={project.banner} alt={`${project.name} Banner`} class="banner-image" />
            )
        }
    </div>

    {/* Add tags */}
    <ProjectTags tags={project.tags} />

    {/* Actual project contents */}
    <section id="project" class="mt-4">
        <slot />
    </section>
</MainLayout>

<style is:global>
    /* Hero box specific styling */
    .text h1 {
        @apply pt-0 leading-normal;
    }

    /* Project content specific styling */
    #project h1 {
        @apply pt-4 text-3xl font-bold;
    }

    #project h2 {
        @apply pt-3 text-2xl font-bold;
    }

    #project h3 {
        @apply pt-2 text-xl font-bold;
    }

    #project img {
        @apply mx-auto block rounded;
    }

    #project ol,
    #project ul {
        @apply list-inside list-disc;
    }
</style>

<style>
    .banner-image {
        @apply mx-auto max-w-screen-sm rounded;
    }
</style>
